<!DOCTYPE html>
<html lang="ru">
<head>
    <base href="../../renderer/">
    <meta charset="UTF-8">
    <title>Обратный отсчёт до начала выпускного 2021</title>
    <style>
        *, *:before, *:after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'TT Commons', sans-serif;
        }

        html, body {
            background: #0E1130;
            color: #ffffff;
            width: 100vw;
            height: 100vh;
        }

        body, .panel {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        h1, h2, h3, h4, h5, h6 {
            margin: 0;
            padding: 0;
            line-height: 1;
        }

        h1 {
            font-size: 42pt;
            font-weight: normal;
            z-index: 150;
        }

        #countdown-element {
            font-weight: bold;
            font-size: 136pt;
            z-index: 150;
        }

        #rainbow {
            position: fixed;
            bottom: -32vh;
            right: 0;
            width: 20vw;
            animation: bouncing 5s ease-in-out 0s infinite alternate both;
        }

        #dots {
            position: fixed;
            width: 12vw;
            right: 5vw;
            top: 10vh;
            animation: bouncing 8s ease-in-out 0s infinite alternate both;
        }

        #squares {
            position: fixed;
            left: 4vw;
            bottom: 10vh;
            width: 19vw;
            animation: bouncing 3s ease-in-out 0s infinite alternate both;
        }

        #circle {
            position: fixed;
            bottom: 6vh;
            right: 14vw;
            width: 14vw;
            animation: bouncing 4.5s ease-in-out 0s infinite alternate both;
        }

        #logo {
            position: fixed;
            top: 7.5vh;
            left: 0;
            right: 0;
            margin: 0 auto;
            height: 9vh;
        }

        @keyframes bouncing {
            0% {
                transform: translateY(0);
            }

            100% {
                transform: translateY(-100px);
            }
        }

        .d-none {
            display: none;
        }
    </style>
</head>
<body>
<div id="countdown-panel" class="panel">
    <h1 id="countdown-title"></h1>
    <div id="countdown-element">00:00:00</div>
</div>
<img src="static/logo.svg" alt="" id="logo">
<img src="static/rainbow.svg" alt="" id="rainbow">
<img src="static/circle.svg" alt="" id="circle">
<img src="static/dots.svg" alt="" id="dots">
<img src="static/squares.svg" alt="" id="squares">
<script>
    const {ipcRenderer} = require("electron");

    const panels = {countdown: document.getElementById("countdown-panel")}
    const countdownElement = document.getElementById("countdown-element");
    const countdownTitle = document.getElementById("countdown-title");
    panels.countdown.classList.add("d-none");
    let APP_DATA = null;

    function cycle() {
        if (!APP_DATA)
            return
        const panelInfo = APP_DATA.panels[APP_DATA.panel];
        switch (panelInfo.type) {
            case "countdown":
                countdownTitle.innerHTML = panelInfo.title;
                const delta = Date.parse(panelInfo.until) - Date.now();
                if (delta <= 0) {
                    countdownElement.innerHTML = "00:00:00";
                    return
                }
                let days = Math.floor(delta / (1000 * 60 * 60 * 24));
                let hours = Math.floor((delta % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                let minutes = Math.floor((delta % (1000 * 60 * 60)) / (1000 * 60));
                let seconds = Math.floor((delta % (1000 * 60)) / 1000);
                days = days > 0 ? days + ":" : "";
                hours = hours < 10 ? (hours === 0 ? "" : "0" + hours + ":") : hours + ":";
                minutes = minutes < 10 ? "0" + minutes : minutes;
                seconds = seconds < 10 ? "0" + seconds : seconds;
                countdownElement.innerHTML = `${days}${hours}${minutes}:${seconds}`;
                if (panels.countdown.classList.contains("d-none"))
                    panels.countdown.classList.remove("d-none");
                break;
        }
        window.requestAnimationFrame(cycle);
    }

    function updateData() {
        ipcRenderer.send("read-config");
    }

    ipcRenderer.on("config", (event, args) => {
        const temp = JSON.parse(args);
        if (APP_DATA) {
            const prevPanel = APP_DATA.panel;
            if (temp.panel !== prevPanel)
                panels[APP_DATA.panels[prevPanel].type].classList.add("d-none");
        }
        APP_DATA = temp;
        cycle();
    })
</script>
</body>
</html>